---
title: "Data Analysis Task"
output:
  html_document:
    df_print: paged
author: "Dandara Sousa"
---


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
theme_set(theme_bw())
```

### O que é o dado?

Existem 9 variáveis nos dados sendo elas:

* session_id : Um id único identificando sessões individuais
* search_index : Um contador de buscas em uma mesma sessão ordenado cronologicamente
* session_start_timestamp: O timestamp que a sessão iniciou
* session_start_date : A data e hora que a sessão iniciou
* group : O grupo que pode ser "a" ou "b"
* results : A quantidade de resultados que a busca retornou
* num_clicks : O número de páginas que o usuário visitou a partir da busca
* first_click : A posição do link da página visitada no mecanismo de busca de páginas
* session_length : A duração em segundos da sessão

```{r ETL}

buscas <- read_csv("../data/search_data.csv")

#events <- read_csv("https://github.com/wikimedia-research/Discovery-Hiring-Analyst-2016/raw/master/events_log.csv.gz")

#events <- events %>% slice(1:5e4) # Útil para testar código em dados pequenos. Comente na hora de processá-los para valer.

#events <- events %>% 
#    group_by(session_id) %>% 
#    arrange(timestamp) %>% 
#    mutate(search_index = cumsum(action == "searchResultPage"), # contador de buscas na sessão.
#           date = ymd_hms(timestamp))  %>% 
#    ungroup()

#glimpse(events)
```


### O que queremos saber sobre ele?

#### Qual a nossa taxa diária de clickthrough rate? Como isso varia entre os grupos?

O Discovery Department da Wikimedia define `clickthrough rate` como a proporção de sessões onde o usuário clicou em um dos resultados mostrados.

```{r}
buscas <- buscas %>%
    mutate(date = round_date(session_start_date, unit = "day"))

buscas %>%
    group_by(date) %>%
    summarise(clickthrough_rate = sum(num_clicks > 0)/n()) %>%
    ggplot(aes(date,clickthrough_rate)) +
    geom_point(alpha = .7) +
    geom_line() +
    labs(x="Data", y="Clickthrough Rate") 
```

```{r}
buscas %>%
    group_by(date, group) %>%
    summarise(clickthrough_rate = sum(num_clicks > 0)/n()) %>%
    ggplot(aes(date,clickthrough_rate, color = group)) +
    geom_point(alpha = .7) +
    geom_line() +
    labs(x="Data", y="Clickthrough Rate", colour = "Grupo") 
```

#### Quais resultados as pessoas tendem a clicar primeiro? Como isso muda no dia-a-dia?

```{r}
buscas %>%
    filter(!is.na(first_click)) %>%
    ggplot(aes(first_click)) +
    geom_histogram() +
    scale_x_log10() +
    labs(x="Primeiro Clique", y="Contagem")
```

```{r}
buscas %>%
    group_by(date, first_click) %>%
    filter(!is.na(first_click)) %>%
    summarise(mean = mean(first_click)) %>%
    ggplot(aes(date, mean)) +
    geom_bar(stat = "identity") +
    labs(x="Data", y="Primeiro Clique")
```

```{r}
buscas %>%
    group_by(date, first_click) %>%
    filter(first_click > 1) %>%
    summarise(mean = mean(first_click)) %>%
    ggplot(aes(as.factor(date), first_click)) +
    geom_boxplot() +
    scale_y_log10() +
    labs(x="Data", y="Primeiro Clique")
```

#### Qual a nossa taxa diária de zero results rate? Como isso varia entre os grupos?

O Discovery Department da Wikimedia define `zero results rate` como a proporção de buscas que retornou 0 resultados.

```{r}
buscas %>%
    group_by(date) %>%
    summarise(zero_results = sum(results == 0)/n()) %>%
    ggplot(aes(date,zero_results)) +
    geom_point(alpha = .7) +
    geom_line() +
    labs(x="Data", y="Zero Results") 
```

```{r}
buscas %>%
    group_by(date, group) %>%
    summarise(zero_results = sum(results == 0)/n()) %>%
    ggplot(aes(date,zero_results, color = group)) +
    geom_point(alpha = .7) +
    geom_line() +
    labs(x="Data", y="Zero Results", color = "Grupo") 
```

#### Considere a duração de cada sessão aproximadamente o tempo entre o primeiro e último evento de uma sessão. Escolha uma variável do conjunto de dados e descreva a relação com o tamanho da sessão. Visualise o relacionamento.

```{r}
#criar coluna session_duration
```

